<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bchewy - When2Meet Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .loading-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <h1 class="text-3xl font-bold text-center mb-8 text-indigo-600">ðŸ“… When2Meet Comparison</h1>

        <!-- New explanation section -->
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-8" role="alert">
            <p class="font-bold">Streamline Your When2Meet Coordination</p>
            <p>As your group size grows beyond 5-10 people, checking who has filled out a When2Meet poll becomes increasingly time-consuming. This app solves that problem by quickly comparing your expected participant list with actual When2Meet responses.</p>
            <p class="mt-2"><strong>How it works:</strong></p>
            <ul class="list-disc list-inside ml-4">
                <li>Input your participant list, paste your When2Meet URL, and click "Compare".</li>
                <li>Instantly see who has and hasn't completed the poll, saving you valuable time and effort.</li>
            </ul>
            <p class="mt-2"><strong>Note:</strong> 10 requests/minute limit. Your data is not stored or saved.</p>
        </div>

        <form method="POST" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            {{ form.csrf_token }}
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="names_list">
                    Enter names (one per line):
                </label>
                {{ form.names_list(rows=5, class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700
                leading-tight focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="when2meet_url">
                    When2Meet URL:
                </label>
                {{ form.when2meet_url(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700
                leading-tight focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="flex items-center justify-between">
                <button type="submit"
                    class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Compare
                </button>
            </div>
        </form>

        <div class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p id="loading-message">Initializing the name-o-matic 3000...</p>
            </div>
        </div>

        {% if comparison %}
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-indigo-600">Comparison Report</h2>
                <button onclick="resetForm()"
                    class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Reset
                </button>
            </div>
            <div class="flex flex-col md:flex-row justify-between">
                <div class="w-full md:w-1/2 pr-2">
                    <h3 class="text-lg font-semibold mb-2 text-gray-700">Your List</h3>
                    <ul class="space-y-1">
                        {% for user_name, _ in comparison %}
                        <li
                            class="py-1 px-2 {% if user_name in missing_names %}bg-red-100 text-red-800{% else %}bg-green-100 text-green-800{% endif %} rounded">
                            {{ user_name or '&nbsp;'|safe }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="w-full md:w-1/2 pl-2 mt-4 md:mt-0">
                    <h3 class="text-lg font-semibold mb-2 text-gray-700">When2Meet Names</h3>
                    <ul class="space-y-1">
                        {% for _, w2m_name in comparison %}
                        <li class="py-1 px-2 bg-beige-100 text-beige-800 rounded">
                            {{ w2m_name or '&nbsp;'|safe }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% if missing_names %}
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <h2 class="text-2xl font-bold mb-4 text-red-600">Missing Names</h2>
            <ul class="space-y-1">
                {% for name in missing_names %}
                <li class="py-1 px-2 bg-red-100 text-red-800 rounded">{{ name }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- New section for the generated message -->
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <h2 class="text-2xl font-bold mb-4 text-green-600">Message for Your Group</h2>
            <div class="bg-gray-100 p-4 rounded">
                <p id="generated-message" class="text-gray-800">
                    Hey everyone! I've just checked our When2Meet responses.
                    {% if missing_names %}
                    We're still waiting on responses from: {{ missing_names|join(', ') }}.
                    If that's you, please fill out the When2Meet as soon as possible so we can finalize our meeting
                    time.
                    {% else %}
                    Great news! Everyone has filled out the When2Meet. We're all set to choose a meeting time that works
                    for everyone.
                    {% endif %}
                    Let's aim to finalize our meeting schedule soon. Thanks for your cooperation!
                </p>
            </div>
            <button onclick="copyMessage()"
                class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Copy Message
            </button>
        </div>
        {% endif %}

        {% if error %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
            <strong class="font-bold">Error!</strong>
            <span class="block sm:inline">{{ error }}</span>
        </div>
        {% endif %}

        <script>
            const form = document.querySelector('form');
            const loadingOverlay = document.querySelector('.loading-overlay');
            const loadingMessage = document.getElementById('loading-message');

            const messages = [
                "Summoning the SMU lions for scheduling wisdom...",
                "Consulting the Kwa Geok Choo Law Library for time management secrets...",
                "Decoding the matrix of SMU seminar room bookings...",
                "Channeling the spirit of teamLEAD for group coordination...",
                "Aligning schedules with the precision of SMU's bell curve...",
                "Navigating the maze of SMU's underground concourse for lost time slots...",
                "Harnessing the power of SMU's Bloomberg terminals for availability analysis...",
                "Seeking guidance from the wise owls of SMU's School of Information Systems...",
                "Performing a SWOT analysis on everyone's schedules...",
                "Applying SMU's analytics prowess to solve the scheduling puzzle...",
                "Unleashing the collaborative spirit of SMU's seminar-style learning...",
                "Optimizing timetables with the efficiency of SMU's bidding system...",
                "Syncing schedules faster than SMU's campus Wi-Fi...",
                "Crunching numbers harder than an SMU accountancy major...",
                "Negotiating time slots with the finesse of an SMU law student..."
            ];

            let messageIndex = 0;
            let progress = 0;

            function updateLoadingMessage() {
                const randomIndex = Math.floor(Math.random() * messages.length);
                loadingMessage.textContent = messages[randomIndex];
                progress += 10;
                if (progress < 100) {
                    setTimeout(updateLoadingMessage, 3000);
                }
            }

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                loadingOverlay.style.display = 'block';
                updateLoadingMessage();
                this.submit();
            });

            function copyMessage() {
                const messageElement = document.getElementById('generated-message');
                const messageText = messageElement.innerText;

                navigator.clipboard.writeText(messageText).then(function () {
                    alert('Message copied to clipboard!');
                }, function (err) {
                    console.error('Could not copy text: ', err);
                });
            }

            function resetForm() {
                // Clear form fields
                document.getElementById('names_list').value = '';
                document.getElementById('when2meet_url').value = '';

                // Remove comparison results
                const comparisonResults = document.querySelectorAll('.bg-white.shadow-md.rounded');
                comparisonResults.forEach(result => {
                    if (result.querySelector('h2')) {  // Check if it's a result div
                        result.remove();
                    }
                });

                // Remove any error messages
                const errorMessage = document.querySelector('.bg-red-100.border.border-red-400');
                if (errorMessage) {
                    errorMessage.remove();
                }

                // Scroll to top of the page
                window.scrollTo(0, 0);
            }
        </script>

        <!-- GoatCounter analytics -->
        <script data-goatcounter="https://bchewy.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    </div>
</body>

</html>